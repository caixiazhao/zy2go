自由之战2 AI模型初步构想

主要思路：将行为树与神经网络结合，利用pythonnet实现python于c#的协同。

当前构想：总体上利用行为树来控制角色的行动，同时利用python搭建基于keras的神经网络模型，并将模型嵌入行为树的分支来调用模型。行为树可以负责控制角色进行常规简单的操作，在这一点上已有的行为树技术有能力提供超过普通玩家的精准操作。神经网络可以用来解决一些情况复杂的或者难以抽象的问题，例如提供高层次的策略和战术；提供复杂战斗场景下的具体操作，比如走位和施法；可能还能提供一些特殊的小技巧（dota中的卡兵线）。

总体设计的行为树大致如下：

![avatar](https://github.com/sky4star/zy2go/blob/master/image/tree1.PNG?raw=true)

在行为树中策略子树和行为子树是并行进行的，在行动的同时策略子树也会实时的修改策略从而达到利用有限的简单策略实现复杂的战术行为的目的。而如何变换策略作出决定则需要通过训练和学习让神经网络模型自己找到内在的联系和规律。
初步设计的AI模型包含两到三个神经网络，其中最重要的部分是为模型提供高层次策略的神经网络。
>当前的设计中，我们设定了战斗，撤退，对线，打野，gank，守卫，支援和埋伏几种策略，对于每一种策略我们会在行为树中设计对应的子树来负责相关的行为。这几种策略的大致意义和目标如下：
>>战斗：进入具体的战斗模式，并为角色提供一个攻击目标并交由对应子树来控制具体动作。由于单挑，团战本质上一次都只能以一个敌人/方向作为攻击的目标，所以模型一次只会决定一个攻击目标。由于策略子树可能快速的切换策略所以即便每次只能指定一个目标，AI也有可能在复杂的团战中实时确定当前最佳的攻击目标并做出动作。具体的动作子树可以用一个战斗用神经网络来决定具体的施法走位。
>>
>>撤退：进入撤退模式并提供一个移动方向，该策略并不一定是要完全撤退到会恢复点，可能只是在团战中暂时的后退避免被集火或者抗塔然后快速的切换回战斗模式继续输出。但在低血量情况下撤退策略也可能会持续工作使得角色彻底撤退到安全区域并进行恢复。对应的行动子树只需要进行位移操作所以可以由行为树来控制，可以包含利用闪现，回城来逃离（可能还可以使用传送，但是如何插旗还没设计，也可能可以使用位移技能逃离或者控制技能阻碍敌人，但是情况太复杂，需要考虑所有可用于逃离的技能，现在暂不考虑）
>>
>>对线：进入线上模式并指定兵线（上中下路）或目标塔。以补兵和拆塔为目标，可以用行为树来控制向目标兵线移动的过程以及补兵推塔的过程。可能会在补兵的过程中实时切换为战斗模式攻击对线的敌方英雄，也可能在补兵拆塔的过程中实时切换为撤退来防止对面gank。在移动过程程中可能可以使用传送（插旗机制暂未考虑），位移技能（暂未考虑）
>>
>>打野：进入打野模式，并指定目标野怪。可以由行为树来控制想野怪移动和打野的过程（攻击施法情况较简单，基本不用考虑走位），同事可以随时切换成撤退和战斗模式来应对突然出现的敌人或潜在的危险。
>>
>>gank：进入gank模式并指定gank目标，可由行为树来控制向目标移动的过程并在接近目标后切换为埋伏或战斗模式然后进行战斗。在向目标移动过程中若出现不再适合gank的情况可有策略模块切换回打野对线等模式，放弃gank继续发育。
>>
>>守卫：指定守护的目标建筑并进入守卫模式。可由行为树控制向守护目标移动，到塔后可能切换至对线/战斗等模式来应对敌方兵线或英雄。
>>
>>支援：指定支援目标角色（可以是自己）并进入支援模式，主要适用于辅助英雄。由可由行为树来确认为队友加血，施加buff，去除debuff的行为，需考虑全部英雄技能。
>>
>>埋伏：指定埋伏地点并进入埋伏模式，可由行为树来控制等待敌人靠近再切换为战斗模式对敌方角色进行攻击。
>>
>当前非战斗状态下未考虑插旗，放草丛，释放技能等问题，部分行为树需要提前了解英雄技能（特别是支援行为）。所有的过程中均可能放弃当前策略切换成不同策略来应对当前状况变化（例如守卫移动中变为战斗/撤退来应对突然出现的敌人）。当前策略与行为并行的设计最重要前提是确保策略计算的速度足够快，能随时响应局势的变换来更新策略。该网络所需要的输入输出情况如下：
>>输入：
>>>地图信息：地图，可达区域，我方可见区域，建筑坐标，可见角色坐标，可见兵线坐标
>>>
>>>建筑：坐标，血量，攻击力，收益（拆掉该建筑可获得的经验、金钱），是否兵营
>>>
>>>兵线：位置，移速，战斗力（可以用一个战斗分来描述一队士兵的当前状态，或者用具体的兵种，士兵数量，血量，攻击力等具体数值来描述兵线）
>>>
>>>野怪：位置，刷新状态，野怪类型，战斗力（同兵线战斗力，用分数来描述一处野怪的战斗力或者用具体的兵种，血量，攻击，技能等属性），收益（经验金钱），效果（打完后能为团队或个人提供的效果，在实际比赛中抢野怪的战斗经常发生，关键野怪所提供的效果可能比击杀敌人更有价值，效果属性和野怪类型不仅可以用于决定打野，还可以在围绕关键野怪展开的对战过程中适时的切换为打野模式来抢夺大小龙，红蓝buff等有用资源）
>>>
>>>英雄：位置，血量，战斗分（各类属性值，装备情况，技能情况），收益（可帮助模型在团战中优先选择可能击杀并能获得更多经验金钱的角色作为攻击目标）（在决策时对于英雄我们还是希望能输入详细信息，以便在混乱的战斗中能实时的决定全局收益最高的战斗目标）
>>>
>>输出：策略+目标
>>
>用战斗分一类的数值来代替详细数据一方面可以缩减计算量，一方面还可以模拟真实玩家无法从小地图获得如此多详细信息的情况
>

>第二个神经网络是用于控制具体走位施法的战斗用神经网络。由于实际上游戏操作中玩家只会用左右两边手指进行操作，所以只需要指定两个输出来模拟左右手可能做出的操作即可。模型输入输出如下
>>输入：
>>>区域地图：模拟屏幕只能看到部分战场，只取部分区域的具体信息加入计算，缩减计算量。地图部分信息应包括各类对象（英雄，兵，野怪，建筑）的位置和可达区域，后续所有输入信息都只考虑在该区域内的对象的信息
>>>
>>>建筑：坐标，血量，攻击力（由于该情况攻击目标为敌方英雄所以不考虑拆塔收益，只考虑是否在走位于攻击过程中如何避开塔攻击或者减少被塔攻击）
>>>
>>>小兵：坐标，攻击，待补充（同理由于攻击目标为敌方英雄，需要考虑的只是不被兵线抵挡走位或被小兵集火）
>>>
>>>野怪信息：位置，攻击，待补充
>>>
>>>英雄信息：在具体战斗中我们希望获得尽可能详细的英雄信息用于做出决策（除了攻击的目标英雄，我们还应考虑其他英雄来合理走位释放技能）
>>>>属性信息：hp/mp，hp/mp上限，hp/mp回复速度（部分英雄不用蓝施法可能还要考虑怒气值之类的属性），攻击力，法强，护甲，魔抗，穿甲，法穿，吸血，魔法吸血，攻速，移速，冷却压缩，暴击率，爆伤，各类成长（全部属性成长值）
>>>>
>>>>装备情况（可能可以不用考虑，因为所提供的属性加成会被计算在属性内，提供的效果会被计算在buff内）
>>>>
>>>>技能情况：冷却，伤害，范围，效果
>>>>
>>>>buff/debuff:加成内容及持续时间，特殊效果及持续时间
>>>>
>>>>位置信息及其他待补充信息
>>>>
>>>目标：目标英雄ID
>>>
>>>可能还用的上前一帧的各个英雄的动作和状态变化，或者位移信息和攻击信息（也可能通过在网络中添加RNN/LSTM来实现对之前操作和变化的记忆效果）
>>>
>>输出：
>>>移动方向
>>>
>>>攻击手段：技能/普攻，释放方向/目标
>>>
>>
>

>对于其他操作或者其他情况我们可能会后续另外添加神经网络来取代行为树的操作
>

当前模型的优势是能够为AI提供一个全局的策略和大局观并对不同策略提供相应的操作，并在具体战斗中提供灵活多变的走位和施法。
该模型现有的问题是如何将模型打包进决策树，如何实现python与C#间的有效通信以及如何有效的进行训练。
对于现在两个神经网络，目前的设计是利用卷积网络来处理地图等大局信息利用全连接网络来处理细节信息，利用递归神经网络神经网络来给模型记忆的能力从而做出更长远而有效的策略。网络的具体模型应该是多个输入层单个输出层，将大量的信息转化为简单明确的指令输出。
对于各类信息的输入和输出的编码也是我们所需要解决的重要问题。